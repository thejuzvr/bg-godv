import type { Character, Weather } from '@/types/character';

type ThoughtCategory =
  | 'generic_happy'
  | 'generic_neutral'
  | 'generic_sad'
  | 'low_health'
  | 'in_combat'
  | 'traveling'
  | 'in_city'
  | 'weather_rain'
  | 'weather_snow'
  | 'weather_clear'
  | 'weather_fog'
  | 'faction_companions'
  | 'faction_college'
  | 'faction_thieves'
  | 'faction_dark_brotherhood';

const thoughts: Record<ThoughtCategory, string[]> = {
  generic_happy: [
    'Какой прекрасный день для приключений!',
    'Сегодня мне море по колено!',
    'Кажется, сама удача мне улыбается.',
    'Нужно будет отметить этот день в таверне!',
    'Раньше я был искателем приключений, но потом... НЕТ, У МЕНЯ ВСЕ В ПОРЯДКЕ С КОЛЕНОМ!',
    'Нашел сладкую булочку! Никто не украл её! Это лучший день в моей жизни!',
    'Сегодня я не встретил Назима. Идеальный день.',
    'М\'Айк говорит правду! Иногда.',
    'Фус... РО ДА! Это никогда не надоест!',
    'Даже мой компаньон не потерялся сегодня. Чудеса!',
    'Сладкий рулет нашёлся и не исчез! Мир полон чудес.',
    'Сегодня даже грязекрабы выглядят дружелюбными.',
    'Солнце греет, кошель полон, броня блестит — красота.',
    'Если это сон — не будите. Хотя нет, будите со сладким рулетом.',
    'Драконы где-то там, а у меня пирожок. Баланс вселенной соблюдён.',
    'Колесо сыра — лучший спутник. Никогда не спорит.',
    'Талос улыбается. Или это бард на площади? Неважно — приятно.',
    'Коллеги-маги бы мной гордились… если бы знали, кто я.',
    'Если день начался без Назима — это хороший день.',
    'Иногда удача — это просто запасные носки.',
  ],
  generic_neutral: [
    'Герой смотрит на облака, размышляя о вечном.',
    'Интересно, что сегодня на ужин в "Гарцующей кобыле"?',
    'Нужно было все-таки украсть тот сладкий рулет...',
    'Еще один день, еще один септим.',
    'Пора бы проверить, не завалялось ли что-то ценное в карманах.',
    'Интересно, сколько колес сыра я смогу унести?',
    'Может, стоит надеть ведро на голову торговцу и ограбить его?',
    'Я бывал в Облачном квартале чаще, чем Назим думает.',
    'Деревянная тарелка... Интересно, можно ли с её помощью пройти сквозь стены?',
    'Где-то там бродит М\'Айк. Хотел бы я знать, что он сейчас делает.',
    'Курица смотрит на меня. Не буду её трогать. НИ ЗА ЧТО.',
    'Корзина на голове... Это стильно или глупо? Наверное, оба варианта.',
    'У меня в инвентаре 47 колес сыра. Это много или мало?',
    'Может, почитать "Похотливую аргонианку"? Для культурного развития, конечно.',
    'Где-то рядом карман звенит громче других… любопытно.',
    'Если надеть два шлема — будет ли вдвое безопаснее?',
    'Сколько мёда нужно, чтобы забыть этот день? Теоретически.',
    'Новый сапог трет пятку. Старый сапог — душу.',
    'Инвентарь опять полон. Время для философии… или продажи.',
    'Стражник зевает. Я тоже. И всё-таки мы по разные стороны закона.',
    'Побродить по рынку или потренироваться? Вечная дилемма.',
  ],
  generic_sad: [
    'Все тлен... Может, пойти в таверну?',
    'Иногда я задаюсь вопросом, а стоит ли оно того?',
    'Еще один серый день в этом сером мире.',
    'Может, стоило выбрать другую судьбу?',
    'Кто-то украл мою сладкую булочку... Снова.',
    'Раньше я был искателем приключений, но потом мне прострелили колено...',
    'Назим снова спросил про Облачный квартал. Моя душа болит.',
    'Мой компаньон застрял в двери. Опять.',
    'Даже Шеогорат не одобрил бы этот день.',
    'Курица на меня смотрит осуждающе. Она помнит.',
    'Таверна близко, но кошелёк пуст. Настоящая трагедия.',
    'Доспехи тяжёлые, а сердце — ещё тяжелее.',
    'Магия кончилась, зелья пусты, надежда в перезарядке.',
    'Погода хмурая, как лицо ярла, когда я рядом.',
    'Иногда кажется, что драконы вежливее людей.',
    'Шаг вперёд, два назад — и так весь квест.',
    'Сон не лечит печаль, но превращает её в зевок.',
  ],
  low_health: [
    'Раны ноют. Нужно быть осторожнее.',
    'Нужно найти место для отдыха, и как можно скорее.',
    'Еще один такой удар, и я отправлюсь в Совнгард.',
    'Может, где-то завалялось зелье здоровья?',
    'Надо было не трогать того краба. Кто же знал, что он так больно щипается?',
    'Может, съесть колесо сыра? Или три?',
    'Это хуже, чем стрела в колено...',
    'Даже капуста бы меня сейчас спасла. ГДЕ ЖЕ ТА КАПУСТА?!',
    'Нужна сладкая булочка силы. СРОЧНО.',
    'М\'Айк говорил, что это безопасно. М\'Айк лгал.',
    'Щит! Где мой щит?!',
    'Кровь в ботинке. Неприятно, но эстетично.',
    'Каждый вдох — как бросок D20 на выживание.',
    'Надо лечиться. Или хотя бы не умирать красиво.',
    'Аптекарь говорил: пить по ложке. Я выпил весь пузырёк.',
    'Если выживу — куплю толстый шлем. И вторую жизнь.',
    'Сыр — не зелье здоровья. Но вкусно.',
  ],
  in_combat: [
    'За славу и честь!',
    'Это будет славная битва!',
    'Я покажу тебе силу!',
    'Вперед, к победе!',
    'ФУС РО ДА!!!',
    'Сейчас ты почувствуешь вкус моего сыра!',
    'Никто не украдет мою сладкую булочку и уйдет живым!',
    'Я покажу тебе, что значит Довакин!',
    'За Скайрим! За норд ов!',
    'Вам конец, молокососы!',
    'Мне плевать, что ты курица! Ты зашла слишком далеко!',
    'Сталь поёт, а я подпеваю.',
    'Щит держи выше, голову — ниже, дух — выше.',
    'Руки помнят больше, чем голова. Вперёд!',
    'Сейчас — удар, потом ещё. А потом — победа.',
    'Неважно, кто передо мной. Важно, кто за мной.',
    'Ставка: один критический успех. Принимается?',
    'Удар, шаг, вдох, выдох. Танец стали.',
    'Я видел хуже. И выжил. Ещё раз выживу.',
  ],
  traveling: [
    'Дорога зовет, и я должен идти.',
    'Интересно, что ждет меня за следующим холмом?',
    'Скайрим велик, и я хочу увидеть его весь.',
    'Надеюсь, впереди не будет засады.',
    'Интересно, встречу ли я М\'Айка на этой дороге?',
    'Может, найду мод на лошадях-драконах... стоп, это уже бред.',
    'Томас Паровозик-дракон пролетел мимо. Это был странный день.',
    'Надеюсь, колеса сыра не слишком тяжелые для путешествия.',
    'Вдали виднеется Назим. Сворачиваю в другую сторону.',
    'Ведро на голове мешает смотреть на дорогу.',
    'Следы уводят влево. Интуиция — вправо. Пойду по настроению.',
    'Карта шуршит, как будто знает больше меня.',
    'Дорога — лучший учитель. Жаль, что строгий.',
    'Сапоги просятся в ремонт. Ноги — в отдых.',
    'Где-то рядом лагерь. Пахнет дымком и приключениями.',
    'Иногда хочу лошадь. Иногда — корабль. Чаще — перерыв.',
    'Над головой ясно. Под ногами — вопросы.',
  ],
  in_city: [
    'Городская суета утомляет, но здесь хотя бы безопасно.',
    'Может, заглянуть в местную лавку? Вдруг там есть что-то интересное.',
    'Слышал, ярл предлагает работу. Надо бы узнать поподробнее.',
    'Запах свежего хлеба из пекарни... как же хорошо!',
    'Вижу Назима вдали. Быстро сворачиваю в переулок.',
    'Кто-то продает сладкие булочки! Нужно купить ВСЕ!',
    'Стражники смотрят подозрительно. Наверное, помнят про курицу...',
    'В Облачном квартале я бываю! Я БЫВАЮ, НАЗИМ!',
    'Торговец снова жалуется на ведро. Может, помочь ему?',
    'Грязевой краб-торговец где-то здесь. Нужно найти его!',
    'Каджиты продают... что-то подозрительное. Скуму, наверное.',
    'Видел М\'Айка у фонтана. Он рассказывал что-то про летающих китов.',
    'Площадь шумит, кошельки звенят. Музыка для вора.',
    'Кузнец бьёт молотом, а я — мысли в порядок.',
    'Алхимик улыбается слишком широко. Непростые зелья.',
    'Ребятишки играют в героев. Надо бы дать им автограф.',
    'Слухи бегут быстрее меня. Хоть бы один меня подождал.',
    'Стражники скучают. Это редкая и опасная погода.',
    'Рынок зовёт. А кошелёк отговаривает.',
    'Таверна пахнет мёдом и решениями.',
  ],
  weather_rain: [
    'Опять этот дождь. Дороги развезло, идти будет тяжело.',
    'Нужно найти укрытие от ливня.',
    'Холодно и сыро. Не лучшая погода для путешествий.',
    'Сырные колеса намокают. ЭТО КАТАСТРОФА!',
    'Ведро на голове хотя бы защищает от дождя.',
    'Дождь смоет следы. И мои сладкие булочки размокнут...',
    'Капюшон спасает голову, но не мысли.',
    'Мосты скользкие, разговоры — тоже.',
    'Дождь стучит по шлему как барабанщик из таверны.',
  ],
  weather_snow: [
    'Снег заметает следы. И мои, и чужие.',
    'Холодно... нужно согреться у костра.',
    'Зима в Скайриме сурова, но прекрасна.',
    'Снег... Снег никогда не меняется.',
    'Холодно. Даже Ледяной король меня пожалел бы.',
    'Заморозил сыр. Теперь это сырное оружие.',
    'Снег скрипит, как совесть после плохого квеста.',
    'Варежки мешают доставать меч. Но пальцы дороже.',
  ],
  weather_clear: [
    'Какой прекрасный день! Солнце светит, птички поют.',
    'Отличная погода для приключений!',
    'Ясное небо — хороший знак.',
    'Идеальная погода для кражи сладких булочек!',
    'Солнце светит, драконы не летают. Отличный день!',
    'Ясная погода. Даже Назима не видно. Идеально.',
    'Небо такое чистое, что хочется извиниться перед ним.',
    'Солнце — лучший факел. Не ломается и не тухнет.',
  ],
  weather_fog: [
    'Туман, как молоко. Ничего не видно.',
    'В таком тумане легко заблудиться или попасть в засаду.',
    'Нужно быть вдвойне осторожным.',
    'Туман... Может, это М\'Айк напустил его?',
    'Ничего не видно. Хорошо, что у меня есть ведро на голове!',
    'Туман такой густой, что даже Назим меня не найдёт.',
    'Кажется, рядом кто-то есть. Или это я сам.',
    'Шёпоты в тумане — не ходи на звук.',
  ],

  // === FACTION THOUGHTS ===
  faction_companions: [
    'Соратники... Они понимают, что такое честь и доблесть.',
    'Йоррваскр зовет. Может, стоит заглянуть к Соратникам?',
    'Эйла говорила об испытании. Интересно, готов ли я?',
    'Слава Соратников гремит по всему Скайриму. Хочу быть частью этого.',
    'Вайтран - дом Соратников. Здесь я чувствую себя сильнее.',
    'Кодекс чести Соратников... Это то, что мне нужно.',
    'В Йоррваскре тепло не только от огня.',
    'Тренировки напоминают — сила любит порядок.',
  ],
  faction_college: [
    'Коллегия Винтерхолда... Там хранятся древние знания.',
    'Магия - это не просто заклинания, это понимание мира.',
    'Толфир говорил об экзамене. Может, я готов к испытанию?',
    'Винтерхолд манит своими тайнами и знаниями.',
    'Архимаг... Звучит внушительно. Хочу стать им.',
    'Магические артефакты Коллегии - это нечто невероятное.',
    'Свитки шепчут, если правильно слушать.',
    'Знание — тяжёлая броня. Но лучше, чем ничего.',
  ],
  faction_thieves: [
    'Гильдия Воров... Они знают все секреты Рифтена.',
    'Бринйольф предлагал работу. Интересно, что это за дело?',
    'В тени Рифтена скрывается целая империя воров.',
    'Канализация... Не самое приятное место, но там есть свои секреты.',
    'Мастер Гильдии... Это звучит заманчиво.',
    'Воровские навыки могут пригодиться в этом мире.',
    'Тихий шаг — громкая слава.',
    'Сундук — это закрытая возможность.',
  ],
  faction_dark_brotherhood: [
    'Темное Братство... Они служат Матери Ночи.',
    'Астрид говорила о контракте. Интересно, что это за работа?',
    'Смерть - это искусство, а я хочу стать мастером.',
    'Мать Ночи смотрит на меня. Чувствую ее присутствие.',
    'Контракты Братства... Это не просто убийства, это ритуал.',
    'В тени любого города можно найти представителей Братства.',
    'Шёпот Матери Ночи — холоднее снега.',
    'Тень — лучшая мантия.',
  ],
};

function getRandomThought(category: ThoughtCategory): string {
  const categoryThoughts = thoughts[category];
  return categoryThoughts[Math.floor(Math.random() * categoryThoughts.length)];
}

export function getFallbackThought(character: Character): string {
  // Priority-based selection
  if (character.status === 'in-combat') {
    return getRandomThought('in_combat');
  }
  if (character.stats.health.current / character.stats.health.max < 0.3) {
    return getRandomThought('low_health');
  }
  if (character.currentAction?.type === 'travel') {
    return getRandomThought('traveling');
  }
  if (character.status === 'idle' && character.location) {
     return getRandomThought('in_city');
  }

  // Faction-based thoughts (if character has reputation with a faction)
  if (character.factions) {
    // Map locations to faction thought categories
    const locationToFaction: Record<string, string> = {
      'whiterun': 'companions',
      'winterhold': 'college',
      'riften': 'thieves',
      'solitude': 'dark_brotherhood',
      'windhelm': 'dark_brotherhood',
      'markarth': 'dark_brotherhood',
    };
    
    const factionId = locationToFaction[character.location];
    if (factionId && character.factions[factionId] && character.factions[factionId].reputation > 0) {
      // 30% chance to think about faction when in their city
      if (Math.random() < 0.3) {
        return getRandomThought(`faction_${factionId}` as ThoughtCategory);
      }
    }
  }

  // Weather-based thoughts
  switch (character.weather) {
    case 'Rain':
      return getRandomThought('weather_rain');
    case 'Snow':
      return getRandomThought('weather_snow');
    case 'Fog':
      return getRandomThought('weather_fog');
    case 'Clear':
       if (Math.random() < 0.3) return getRandomThought('weather_clear'); // Only sometimes
       break;
  }
  
  // Mood-based thoughts
  if (character.mood > 70) {
    return getRandomThought('generic_happy');
  }
  if (character.mood < 40) {
    return getRandomThought('generic_sad');
  }
  
  // Default neutral thought
  return getRandomThought('generic_neutral');
}
