 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Ä–æ–Ω–∞ –≤ –±–æ—é —Å–ª–æ–º–∞–Ω–æ
–ü—Ä–æ–±–ª–µ–º–∞: –í performCombatRound –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è damageTaken —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è –∫ combat.totalDamageTaken.

// –°—Ç—Ä–æ–∫–∏ 433-445 –≤ brain.ts
let damageTaken = Math.max(1, Math.floor(baseEnemyDef!.damage * 1.5));
updatedChar.stats.health.current -= damageTaken;
// ‚ùå –ù–ï–¢: updatedChar.combat.totalDamageTaken += damageTaken;
–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:

–í combat analytics –≤—Å–µ–≥–¥–∞ damageTaken: 0
–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Å–∫–æ–ª—å–∫–æ —É—Ä–æ–Ω–∞ –ø–æ–ª—É—á–∏–ª –ø–µ—Ä—Å–æ–Ω–∞–∂
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ–µ–≤ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è
2. –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤ –±–æ—è
–ü—Ä–æ–±–ª–µ–º–∞: –ë–æ–π –º–æ–∂–µ—Ç –¥–ª–∏—Ç—å—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –µ—Å–ª–∏ —É—Ä–æ–Ω –Ω–∏–∑–∫–∏–π —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω.

–°—Ü–µ–Ω–∞—Ä–∏–π:

–ü–µ—Ä—Å–æ–Ω–∞–∂ 1 —É—Ä–æ–≤–Ω—è —Å —É—Ä–æ–Ω 2-3 –ø—Ä–æ—Ç–∏–≤ –≤—Ä–∞–≥–∞ —Å 100 HP
–í—Ä–∞–≥ —Å —É—Ä–æ–Ω–æ–º 2 –ø—Ä–æ—Ç–∏–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å 80 HP –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º –ª–µ—á–µ–Ω–∏–µ–º
–ë–æ–π –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å—Å—è 50+ —Ä–∞—É–Ω–¥–æ–≤
–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:

Background worker –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –Ω–∞ –æ–¥–Ω–æ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ
–õ–æ–≥–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç—Å—è
–ü–ª–æ—Ö–æ–π gameplay experience
3. Damage dealt —Ç–∞–∫–∂–µ –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
–ü—Ä–æ–±–ª–µ–º–∞: –£—Ä–æ–Ω –æ—Ç –∞—Ç–∞–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è, –Ω–æ —É—Ä–æ–Ω –æ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ totalDamageDealt.

// –°—Ç—Ä–æ–∫–∏ 356-358 - —É—Ä–æ–Ω –æ—Ç –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π
case 'damage':
    enemy.health.current -= spellToCast.value;
    // ‚ùå –ù–ï–¢: updatedChar.combat.totalDamageDealt += spellToCast.value;
‚ö†Ô∏è –°–µ—Ä—å–µ–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã AI –ª–æ–≥–∏–∫–∏:
4. Travel Penalty –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
–ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ 3 –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π –ø–æ–¥—Ä—è–¥ travelAction –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è (–≤–µ—Å = 0).

–°—Ü–µ–Ω–∞—Ä–∏–π:

–ü–µ—Ä—Å–æ–Ω–∞–∂ –≤ –æ–ø–∞—Å–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ –±–µ–∑ –∫–≤–µ—Å—Ç–æ–≤
–ü—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞–ª 3+ —Ä–∞–∑–∞
–¢–µ–ø–µ—Ä—å –Ω–µ –º–æ–∂–µ—Ç –ø–æ–∫–∏–Ω—É—Ç—å –ª–æ–∫–∞—Ü–∏—é
–ú–æ–∂–µ—Ç –∑–∞—Å—Ç—Ä—è—Ç—å –≤ —Ü–∏–∫–ª–µ wanderAction –∏–ª–∏ findEnemyAction ‚Üí —Å–º–µ—Ä—Ç—å
Escape –º–µ—Ö–∞–Ω–∏–∑–º: –ï—Å—Ç—å —á–µ—Ä–µ–∑ divine suggestion, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞.

5. WanderAction –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ü–∏–∫–ª –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
–ü—Ä–æ–±–ª–µ–º–∞: –ï—Å–ª–∏ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∏–º–µ—é—Ç –≤–µ—Å 0, –ø–µ—Ä—Å–æ–Ω–∞–∂ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ wanderAction —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 85% –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å.

// –°—Ç—Ä–æ–∫–∞ 1112-1114
if (Math.random() > 0.15) {
    return { character, logMessage: "" }; // 85% - –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
}
6. FindEnemyAction –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ
–ü—Ä–æ–±–ª–µ–º–∞: –†–µ—à–µ–Ω–∏–µ –æ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –≤ –±–æ–π –æ—Å–Ω–æ–≤–∞–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è:

–ù–∞–ª–∏—á–∏–µ –∑–µ–ª–∏–π –ª–µ—á–µ–Ω–∏—è
–ö–∞—á–µ—Å—Ç–≤–æ –æ—Ä—É–∂–∏—è –∏ –±—Ä–æ–Ω–∏
–ù–∞–ª–∏—á–∏–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π
–°–∏–ª—É –≤—Ä–∞–≥–∞ –≤ –ª–æ–∫–∞—Ü–∏–∏
–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è: –ü–µ—Ä—Å–æ–Ω–∞–∂ –º–æ–∂–µ—Ç –≤—Å—Ç—É–ø–∞—Ç—å –≤ —Å–º–µ—Ä—Ç–µ–ª—å–Ω—ã–µ –±–æ–∏ –±—É–¥—É—á–∏ —Å–ª–∞–±–æ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.

üü° –ú–µ–ª–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
7. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≤–∞–ª (roll=1) —É—Ä–æ–Ω –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
// –°—Ç—Ä–æ–∫–∞ 324
if (Math.random() > 0.5) updatedChar.stats.health.current -= 2;
// ‚ùå –°–∞–º–æ—É—Ä–æ–Ω –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ totalDamageTaken
8. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç race conditions –≤ –ë–î
–í PostgresCharacterRepository –æ–ø–µ—Ä–∞—Ü–∏–∏ saveCharacter –∏ fetchCharacter –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏:

Background worker –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç divine intervention
–ü–æ—Å–ª–µ–¥–Ω—è—è –æ–ø–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞):
–ü–µ—Ä–≤–æ–æ—á–µ—Ä–µ–¥–Ω—ã–µ:
‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Ä–æ–Ω–∞ - –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–µ damageTaken –∏ damageDealt –∫ —Å—á–µ—Ç—á–∏–∫–∞–º
‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç —Ä–∞—É–Ω–¥–æ–≤ –±–æ—è - –º–∞–∫—Å–∏–º—É–º 30 —Ä–∞—É–Ω–¥–æ–≤, –ø–æ—Å–ª–µ —á–µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–±–µ–≥ –∏–ª–∏ –Ω–∏—á—å—è
‚úÖ –£–ª—É—á—à–∏—Ç—å combat analytics - –≤–∫–ª—é—á–∏—Ç—å –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —É—Ä–æ–Ω–∞
–í–∞–∂–Ω—ã–µ:
‚úÖ –£–ª—É—á—à–∏—Ç—å AI –ª–æ–≥–∏–∫—É findEnemyAction - —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ, –∑–µ–ª—å—è, —Å–∏–ª—É –≤—Ä–∞–≥–∞
‚úÖ –î–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è travel penalty - –µ—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –∑–∞—Å—Ç—Ä—è–ª 5+ —Ç–∏–∫–æ–≤ –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π, —Ä–∞–∑—Ä–µ—à–∏—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ
‚úÖ –£–ª—É—á—à–∏—Ç—å wanderAction - –ø–æ–≤—ã—Å–∏—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º—ã—Å–ª–∏ –¥–æ 30% —á—Ç–æ–±—ã –±—ã–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ
–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–¥–ª—è –±–∞–ª–∞–Ω—Å–∞):
üîÑ –î–æ–±–∞–≤–∏—Ç—å timeout protection –≤ –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏ - –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
üîÑ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –±–æ–∏ - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –±–æ–π > 20 —Ä–∞—É–Ω–¥–æ–≤